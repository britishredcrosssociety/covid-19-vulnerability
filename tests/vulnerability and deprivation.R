##
## Investigate correlations between vulnerability and deprivation
##
library(tidyverse)
library(ggcorrplot)
library(cowplot)
library(GGally)

source("load lookup tables.r")  # for get_country()

# ---- Load VI ----
vi = read_csv("output/vulnerability-MSOA-UK.csv")

vi = vi %>% 
  mutate(Country = get_country(Code)) %>% 
  select(Code, Country, ends_with("rank")) %>% 
  rename_at(vars(ends_with("rank")), ~ str_extract(., "\\w+")) %>%   # just keep first word in rank column names
  select(-Digital)

# ---- Load deprivation ----
imd_eng = read_csv("https://github.com/matthewgthomas/IMD/raw/master/data/English%20IMD%20-%20MSOA.csv")
imd_wal = read_csv("https://github.com/matthewgthomas/IMD/raw/master/data/Welsh%20IMD%20-%20MSOA.csv")
imd_sco = read_csv("https://github.com/matthewgthomas/IMD/raw/master/data/Scottish%20IMD%20-%20MSOA.csv")

imd = bind_rows(imd_eng, imd_wal, imd_sco)

vi_eng = vi %>% 
  filter(Country == "England")

cor.test(vi_eng$Vulnerability, imd_eng$Extent)  # 0.4167137
cor.test(vi_eng$Socioeconomic, imd_eng$Extent)  # 0.5203114

vi_gb = vi %>% 
  filter(Country != "Northern Ireland")

cor.test(vi_gb$Vulnerability, imd$Extent)  # 0.2774138
cor.test(vi_gb$Socioeconomic, imd$Extent)  # 0.3500874

vi_gb %>% 
  left_join(imd, by = c("Code" = "MSOA11CD")) %>% 
  ggplot(aes(x = Socioeconomic, y = Extent)) +
  geom_point(alpha = 0.1) +
  geom_smooth()


