library(tidyverse)
library(readxl)

# Read in Wales OSCI data
ocsiw = read_excel("data/OCSI/Wales_COVID_19_Dataset_MSOA.xlsx",
                   col_names = FALSE)

# Change cell values to get a row of consistent variable names
ocsiw[3,1] <- ocsiw[8,1]                
ocsiw[3,2] <- ocsiw[8,2]
ocsiw[3,3] <- ocsiw[8,3]

# Replace NA values with empty strings so string concatenation doesn't fail in later step
ocsiw[6,1] <- ""                
ocsiw[6,2] <- ""
ocsiw[6,3] <- ""

# Remove metadata
ocsiw <- ocsiw %>% slice(c(-1, -2, -4, -5, -7, -8))

# Combine first two rows to create new col names
column_names <- str_c(ocsiw[1,], ocsiw[2,], sep = " ")

# Rename columns
names(ocsiw) <- column_names

# Remove first two rows used to create new column names and
# COVID-19 column
ocsiw <- ocsiw %>% 
  slice(-1:-2) %>% 
  select(-`COVID-19 vulnerability index Score`)

# Rename Aged columns to make variables clear
ocsiw <- ocsiw %>%
  rename_at(vars(starts_with("Aged")), ~ str_c("Proportion of Population ", .))

# Remove whitespace
ocsiw <- ocsiw %>% 
  rename(`MSOA Code` = `MSOA Code `,
         `MSOA Name` = `MSOA Name `,
         `La Name` =  `LA Name `)

# Select columns to be used as vulnerability indicators
# (removed most industry data)
ocsiw <- ocsiw %>% 
  select(c(-37:-53, -55:-70))
