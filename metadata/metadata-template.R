# ---- Load libraries ----
library(tidyverse)

# ---- Overall MSOA Indicators ----
# - Load indicators -
msoa_e <- tibble(indicator = colnames(read_csv("output/vulnerability-MSOA-England.csv")),
          country = "England",
          geography = "MSOA",
          Date = Sys.Date(),
          source = NA,
          domain = NA)

msoa_w <- tibble(indicator = colnames(read_csv("output/vulnerability-MSOA-Wales.csv")),
          country = "Wales",
          geography = "MSOA",
          Date = Sys.Date(),
          source = NA,
          domain = NA)
  
msoa_s <- tibble(indicator = colnames(read_csv("output/vulnerability-MSOA-Scotland.csv")),
          country = "Scotland",
          geography = "MSOA",
          Date = Sys.Date(),
          source = NA,
          domain = NA)
  
msoa_ni <- tibble(indicator = colnames(read_csv("output/vulnerability-SOA-NI.csv")),
           country = "Northern Ireland",
           geography = "SOA",
           Date = Sys.Date(),
           source = NA,
           domain = NA)

# Assign msoa domains fun
assign_msoa_domains <- function(.data){
  .data %>% 
    mutate(domain = case_when(
      row_number() %in% ((which(msoa_e$indicator == "Name") + 1) : (which(msoa_e$indicator == "Clinical Vulnerability decile"))) ~ "Clinical",
      row_number() %in% ((which(msoa_e$indicator == "Clinical Vulnerability decile") + 1) : (which(msoa_e$indicator == "Health/Wellbeing Vulnerability decile"))) ~ "Health/Wellbeing",
      row_number() %in% ((which(msoa_e$indicator == "Health/Wellbeing Vulnerability decile") + 1) : (which(msoa_e$indicator == "Economic Vulnerability decile"))) ~ "Economic",
      row_number() %in% ((which(msoa_e$indicator == "Economic Vulnerability decile") + 1) : (which(msoa_e$indicator == "Social Vulnerability decile"))) ~ "Social",
      row_number() %in% ((which(msoa_e$indicator == "Social Vulnerability decile") + 1) : (which(msoa_e$indicator == "Socioeconomic Vulnerability decile"))) ~ "Socioeconomic",
      TRUE ~ "All"))
}

# Apply msoa domains fun to nations
all_msoa <- map_dfr(list(msoa_e, msoa_w, msoa_s, msoa_ni), assign_msoa_domains)

# Remove rows where indicators are the same and merge countries

