##
## Create UK-wide dataframes for deprivation for wards and Local Authorities
##
library(tidyverse)

reproduce_data = FALSE

if (reproduce_data) {
  source("prep deprivation - England.r")
  source("prep deprivation - Wales.r")
  source("prep deprivation - Scotland.r")
  source("prep deprivation - NI.r")
}

##
## combine ward-level deprivation
##
imd_eng_covid_ward = read_csv("output/covid-deprivation-england-ward.csv")
imd_wal_covid_ward = read_csv("output/covid-deprivation-wales-ward.csv")
imd_sco_covid_ward = read_csv("output/covid-deprivation-scotland-ward.csv") %>% rename(WD17CD = MMWcode)
# imd_ni_covid_ward  = read_csv("output/covid-deprivation-england-ward.csv")  # doesn't exist yet

imd_covid_ward = bind_rows(imd_eng_covid_ward, imd_wal_covid_ward, imd_sco_covid_ward)

write_csv(imd_covid_ward, "output/covid-deprivation-ward.csv")

rm(imd_eng_covid_ward, imd_wal_covid_ward, imd_sco_covid_ward)

##
## combine LA-level deprivation
##
imd_eng_covid_lad = read_csv("output/covid-deprivation-england-LA.csv")
imd_wal_covid_lad = read_csv("output/covid-deprivation-wales-LA.csv")
imd_sco_covid_lad = read_csv("output/covid-deprivation-scotland-LA.csv")
imd_ni_covid_lad  = read_csv("output/covid-deprivation-england-LA.csv")

imd_covid_lad = bind_rows(imd_eng_covid_lad, imd_wal_covid_lad, imd_sco_covid_lad, imd_ni_covid_lad)

write_csv(imd_covid_lad, "output/covid-deprivation-LA.csv")

rm(imd_eng_covid_lad, imd_wal_covid_lad, imd_sco_covid_lad, imd_ni_covid_lad)
